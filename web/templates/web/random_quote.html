{% extends 'web/base.html' %}

{% block title %}–°–ª—É—á–∞–π–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞{% endblock %}

{% block content %}
    {% if quote %}
        <h2>–°–ª—É—á–∞–π–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞:</h2>
        <blockquote id="quote-text">{{ quote.text }}</blockquote>
        <p><strong>–ò—Å—Ç–æ—á–Ω–∏–∫:</strong> {{ quote.source }}</p>
        <p>–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: {{ quote.views }}</p>

        <div id="likes-container">
            <button id="like-btn" data-quote-id="{{ quote.id }}">üëç <span id="likes-count">{{ quote.likes }}</span></button>
            <button id="dislike-btn" data-quote-id="{{ quote.id }}">üëé <span id="dislikes-count">{{ quote.dislikes }}</span></button>
        </div>

        <script>
        document.addEventListener('DOMContentLoaded', () => {
            const likeBtn = document.getElementById('like-btn');
            const dislikeBtn = document.getElementById('dislike-btn');

            function sendLikeDislike(action) {
                const quoteId = likeBtn.dataset.quoteId;
                fetch(`/api/quote/${quoteId}/like/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': '{{ csrf_token }}',
                    },
                    body: new URLSearchParams({ action: action })
                })
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    if(data.likes !== undefined && data.dislikes !== undefined) {
                        document.getElementById('likes-count').textContent = data.likes;
                        document.getElementById('dislikes-count').textContent = data.dislikes;
                    }
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞:', error));
            }

            likeBtn.addEventListener('click', e => {
                e.preventDefault();
                sendLikeDislike('like');
            });

            dislikeBtn.addEventListener('click', e => {
                e.preventDefault();
                sendLikeDislike('dislike');
            });
        });
        </script>

    {% else %}
        <p>–¶–∏—Ç–∞—Ç—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
    {% endif %}
{% endblock %}

